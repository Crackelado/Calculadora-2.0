<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script>
        let y = "";
        let parser = "";
        let xmlDoc = "";
        let x = "";
        let z = "";
        const bOK = "<button onclick=''>OK</button> ";
        const bCancel = "<button onclick='window.location.reload()'>Cancelar</button>";
        const inp = "<input type='text'><br><br>";
        const arit = "+-*/";
        
        function escolha(cad1, cad2) {
            if (z.getElementsByTagName("select")[0] == null) {
                z.innerHTML = "";
                let pag = "<select onchange=" + cad2 + "><option/>";
                Array.from(cad1, (h) => pag += "<option>" + h.textContent + "</option>");
                pag += "</select>";
                z.innerHTML = pag;
            }
       }

        function contas(cad1, cad2, cad3) {
            z.innerHTML = "";
            let pag = "";

            for (i = 0; i < cad3.length; i++) {
                pag += "<p>" + cad1[i].textContent + "</p>" + "<h1>" + cad2[i].textContent + "</h1>";

                if (cad3[i].getElementsByTagName("parc")[0] != null) {
                    pag += limitepgast(cad3[i]);
                }
            }
            
            z.innerHTML = pag;
        }
        
        function selec() {
            let n = z.getElementsByTagName("select")[0].selectedIndex - 1;
            z.innerHTML = "";
            let l = x.childNodes[n];
            let pag = "<p>" + l.getElementsByTagName("descricao")[0].textContent + "</p>" + "<h1>" + l.getElementsByTagName("total")[0].textContent + "</h1>";
            if (l.getElementsByTagName("parc")[0] != null) {
                Array.from(l.getElementsByTagName("valor"), (h, i) => pag += "<p>R$ " + h.textContent.replace(".", ",") + " - " + l.getElementsByTagName("parc")[i].textContent + " parcelas restantes</p>");
                pag += "<p>R$ " + l.getElementsByTagName("compras")[0].textContent.replace(".", ",") + " - compras realizada no mês</p>";
            }
            
            z.setAttribute("onclick", "");
            z.innerHTML = pag + inp + bOK + bCancel;
        }

        function iniciar() {
            if (y == "") {
                y = window.localStorage;
                parser = parser = new DOMParser();
                xmlDoc = parser.parseFromString(y.getItem("teste"), "text/xml")
                x = xmlDoc.childNodes[0];
                z = document.body;
            }
            
            z.setAttribute("onclick", "escolha(x.getElementsByTagName('descricao'), 'selec()')");
            contas(x.getElementsByTagName("descricao"), x.getElementsByTagName("total"), x.childNodes);
        }

        function limitepgast(cad1) {
            let soma = 0;
            Array.from(cad1.getElementsByTagName("parc"), (h, i) => soma += +h.textContent * +cad1.getElementsByTagName("valor")[i].textContent);

            if (cad1.getElementsByTagName("compras")[0] != null) {
                soma += +cad1.getElementsByTagName("compras")[0].textContent;
            }

            soma = Number(+cad1.getElementsByTagName("limite")[0].textContent - soma).toFixed(2);
            return "<p>Limite restante: R$ " + soma.toString().replace(".", ",") + "</p><br>";
        }

        function equacao(cad1, cad2, cad3) {
            try {
                if (cad2 == "") throw "Nenhum valor digitado.";
                if ("+-*/".includes(cad3) == false) throw "Não há sinal de operação aritmética.";
                if (isNaN(cad2)) throw "Esse valor não é um número.";
                if (cad3 == "+") return ((cad1 + cad2) / 100).toFixed(2);
                if (cad3 == "-") return ((cad1 - cad2) / 100).toFixed(2);
                if (cad3 == "*") return ((cad1 * cad2) / 100).toFixed(2);
                if (cad3 == "/") return ((cad1 / cad2) / 100).toFixed(2);
            }
            catch(err) {
                alert(err);
            }
        }

        function numero(cad1) {
            cad1 = cad1.replaceAll(",", ".");
            let tP = cad1.lastIndexOf(".");
            let tN = cad1.slice(0, tP).replaceAll(".", "");

            if (isNaN(Number(cad1.replaceAll(".", ""))) == false) {
                if (tP > -1) {
                    tN += Number(cad1.slice(tP)).toFixed(2).slice(-2);
                    return Number(tN);
                }
                else {
                    return Number(cad1);
                }
            }
        }

        function loopAritmetico(cad1) {
            let t = [new Array(), new Array()];
            t[1][0] = cad1;

            for (let i in cad1) {
                if (arit.includes(cad1[i])) {
                    t[0].push(cad1[i]);

                    if (i > 0) {
                        t[1][0] = t[1][0].replace(cad1[i], ";");
                    }
                    else {
                        t[1][0] = t[1][0].replace(cad1[i], "0");
                    }
                }
            }

            t[1] = t[1][0].split(";");
            return t;
        }

    </script>
</head>
<body onload="iniciar()">
    
</body>
</html>